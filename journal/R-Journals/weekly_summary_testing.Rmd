---
title: "Weekly Reporting"
author: "agrotech live | wigglelabs"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{flushleft}\Huge}  # Title formatting
  - \preauthor{\begin{flushleft}\large}  # Author formatting
  - \predate{\begin{flushleft}\large}  # Date formatting
  - \posttitle{\end{flushleft}}  # End title format
  - \postauthor{\end{flushleft}}  # End author format
  - \postdate{\end{flushleft}}    # End date format
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Abstract
In an ongoing effort to achieve food sovereignty, Wiggle Labs has developed Agrotech Live to monitor the soil health of different plants and crops. This tool collects four data points; Temperature, Moisture, Light and Conductivity from sensors placed near a subject. The training data for this program are the ideal conditions for the subject, and the performance of the experiment is based on how close the collected sensor (testing) data is to the input care training data. Input data is identical in structure the testing data (collected during a session), except it represents only perfect conditions for the subject. A score is generated (along with other statistical results) periodically to communicate how well the experiment is performing.

This report covers the past seven days of session data. If there are missing records, then the closest recorded days will be included.


# Time Series Comparison

This section examines the relationships between sensor variables from the past week and the initial input data we're comparing the session data to. 

```{r preprocess-data, include=FALSE}
suppressPackageStartupMessages(library(dplyr))

# Load data
session_data <- read.csv("data/session.csv")
training_data <- read.csv("data/training.csv")

# Convert timestamps (if needed for other use)
session_data$Timestamp <- as.POSIXct(session_data$Timestamp, format = "%Y-%m-%d %H:%M:%S")
training_data$Timestamp <- as.POSIXct(training_data$Timestamp, format = "%Y-%m-%d %H:%M:%S")


```

``` {r plot-sensor-data, echo=FALSE}
# Sort both datasets by time to ensure chronological order
training_data <- training_data[order(training_data$Timestamp), ]
session_data  <- session_data[order(session_data$Timestamp), ]

# Find the earliest start date from both datasets
start_date <- min(min(training_data$Timestamp), min(session_data$Timestamp))

# Filter both datasets to start from the chosen start date
training_data <- training_data[training_data$Timestamp >= start_date, ]
session_data  <- session_data[session_data$Timestamp >= start_date, ]

# Color setup
train_col <- "green"  # blue
sess_col  <- "#5B9BD5"  # orange

# -------------------
# Helper plotting function using timestamps
plot_overlay <- function(train_y, train_time, sess_y, sess_time, ylabel, title) {
  # Ensure the data aligns based on time
  len <- min(length(train_y), length(sess_y))
  
  plot(train_time[1:len], train_y[1:len],
       type = "l", col = train_col, lwd = 2,
       xlab = "Timestamp",
       ylab = ylabel,
       main = title)
  
  lines(sess_time[1:len], sess_y[1:len],
        col = sess_col, lwd = 2, lty = 2)
  
  legend("topright",
         legend = c("Training", "Session"),
         col = c(train_col, sess_col),
         lty = c(1, 2),
         lwd = 2)
}

# -------------------
# Temperature Plot using Timestamp
plot_overlay(training_data$Temperature, training_data$Timestamp, 
             session_data$Temperature, session_data$Timestamp,
             ylabel = "Temperature", title = "Temperature: Training vs Session")

# -------------------
# Moisture Plot using Timestamp for both Training and Session
plot_overlay(training_data$Moisture, training_data$Timestamp, 
             session_data$Moisture, session_data$Timestamp,
             ylabel = "Moisture", title = "Moisture: Training vs Session")

# Light Plot using Timestamp
plot_overlay(training_data$Light, training_data$Timestamp,
             session_data$Light, session_data$Timestamp,
             ylabel = "Light", title = "Light: Training vs Session")

# Conductivity Plot using Timestamp
plot_overlay(training_data$Conductivity, training_data$Timestamp,
             session_data$Conductivity, session_data$Timestamp,
             ylabel = "Conductivity", title = "Conductivity: Training vs Session")

```

Matrices  
# Correlation Matrices 

``` {r correlation-covariance}
  Temperature <- c(session_data$Temperature)
  Moisture <- c(session_data$Moisture)
  Light <- c(session_data$Light)
  Conductivity <- c(session_data$Conductivity)
  
  matrix_data <- data.frame(Temperature, Moisture, Light, Conductivity)  
  print("Covariance Matrix")
  cov_matrix <- cov(matrix_data)
  cov_matrix
  
  print("Correlation Matrix")
  cor_matrix <- cor(matrix_data)
  cor_matrix
```
Plotting variables against each other.

``` {r compare-relationships}

# Define the color palette
colors <- c(
    temperature = "#5B9BD5",  # Soft blue
    moisture = "#70AD47",     # Sage green
    light = "#FFC000",        # Warm yellow
    conductivity = "#ED7D31"  # Muted orange
)

# Assuming merged_data is your data frame
pairs(merged_data[, c("Temperature", "Moisture", "Light", "Conductivity")],
      col = colors["temperature"],  
      pch = 16,          
      main = "Scatter Plot Matrix")

# Plot Temperature vs Moisture
plot(merged_data$Temperature, merged_data$Moisture,
     col = adjustcolor(colors[c("temperature", "moisture")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Moisture",
     main = "Temperature vs Moisture",
     pch = 16)

# Plot Temperature vs Light
plot(merged_data$Temperature, merged_data$Light,
     col = adjustcolor(colors[c("temperature", "light")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Light",
     main = "Temperature vs Light",
     pch = 16)

# Plot Temperature vs Conductivity
plot(merged_data$Temperature, merged_data$Conductivity,
     col = adjustcolor(colors[c("temperature", "conductivity")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Conductivity",
     main = "Temperature vs Conductivity",
     pch = 16)

# Plot Moisture vs Light
plot(merged_data$Moisture, merged_data$Light,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(merged_data$Moisture, merged_data$Conductivity,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(merged_data$Moisture, merged_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

# Plot Moisture vs Light
plot(merged_data$Light, merged_data$Moisture,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(merged_data$Light, merged_data$Conductivity,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(merged_data$Light, merged_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

# Plot Moisture vs Light
plot(merged_data$Conductivity, merged_data$Moisture,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(merged_data$Conductivity, merged_data$Light,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(merged_data$Conductivity, merged_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

```

# Heatmap

``` {r heatmap}

# Load required library
library(ggplot2)

# Select the relevant variables for correlation
matrix_data <- session_data[, c("Temperature", "Moisture", "Light", "Conductivity")]

# Calculate the correlation matrix
cor_matrix <- cor(matrix_data, use = "complete.obs")

# Convert the correlation matrix into a format suitable for ggplot
cor_data <- as.data.frame(as.table(cor_matrix))
colnames(cor_data) <- c("Variable1", "Variable2", "Correlation")

# Create the heatmap using ggplot2
ggplot(cor_data, aes(x = Variable1, y = Variable2, fill = Correlation)) +
  geom_tile(color = "white") + # Heatmap tiles
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1), 
                       name = "Correlation") + # Color scale
  theme_minimal() + # Clean theme
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) + # Rotate x-axis labels
  labs(title = "Heatmap of Variable Correlations", x = "Variables", y = "Variables")


```