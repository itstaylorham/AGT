---
title: "Weekly Reporting"
author: "agrotech live | wigglelabs"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{flushleft}\Huge}  # Title formatting
  - \preauthor{\begin{flushleft}\large}  # Author formatting
  - \predate{\begin{flushleft}\large}  # Date formatting
  - \posttitle{\end{flushleft}}  # End title format
  - \postauthor{\end{flushleft}}  # End author format
  - \postdate{\end{flushleft}}    # End date format
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Abstract
In an ongoing effort to achieve food sovereignty, Wiggle Labs has developed Agrotech Live to monitor the soil health of different plants and crops. This tool collects four data points; Temperature, Moisture, Light and Conductivity from sensors placed near a subject. The training data for this program are the ideal conditions for the subject, and the performance of the experiment is based on how close the collected sensor (testing) data is to the input care training data. Input data is identical in structure the testing data (collected during a session), except it represents only perfect conditions for the subject. A score is generated (along with other statistical results) periodically to communicate how well the experiment is performing.

This report covers the past seven days of session data. If there are missing records, then the closest recorded days will be included.


# Time Series Comparison

This section examines the relationships between sensor variables from the past week and the initial input data we're comparing the session data to. 

``` {r preprocess-data, include=FALSE}
suppressPackageStartupMessages(library(dplyr))

# Read the latest exported data from main.py
# Location is tentative
session_data <- read.csv("data/session.csv")
training_data <- read.csv("data/training.csv")

# Convert Timestamp to POSIXct for proper datetime comparison
session_data$Timestamp <- as.POSIXct(session_data$Timestamp, format = "%Y-%m-%d %H:%M:%S")
training_data$Timestamp <- as.POSIXct(training_data$Timestamp, format = "%Y-%m-%d %H:%M:%S")

# Create shortened MAC addresses (last 5 characters)
session_data$ShortMAC <- substr(session_data$MAC, nchar(session_data$MAC) - 4, nchar(session_data$MAC))
training_data$ShortMAC <- substr(training_data$MAC, nchar(training_data$MAC) - 4, nchar(training_data$MAC))

# Merge the two datasets on ShortMAC
merged_data <- merge(session_data, training_data, by = "ShortMAC", suffixes = c("_1", "_2"))

# Display the results
summary(merged_data$Timestamp)
names(merged_data)
```

``` {r plot-sensor-data, echo=FALSE}
# Convert Timestamps to POSIXct
merged_data$Timestamp_1 <- as.POSIXct(merged_data$Timestamp_1, format = "%Y-%m-%d %H:%M:%S")

placeholder <- "Lorem ipsum dolor sit amet..."  # Shorten for clarity

# Define color palettes for dataset 1 and dataset 2
temperature_colors_1 <- colorRampPalette(c("#5B9BD5", "#003366"))(length(unique(merged_data$ShortMAC)))
temperature_colors_2 <- colorRampPalette(c("#ADD8E6", "#00008B"))(length(unique(merged_data$ShortMAC)))

moisture_colors_1 <- colorRampPalette(c("#70AD47", "#2F6A21"))(length(unique(merged_data$ShortMAC)))
moisture_colors_2 <- colorRampPalette(c("#98FB98", "#006400"))(length(unique(merged_data$ShortMAC)))

light_colors_1 <- colorRampPalette(c("#FFC000", "#FF7F00"))(length(unique(merged_data$ShortMAC)))
light_colors_2 <- colorRampPalette(c("#FFD700", "#FF4500"))(length(unique(merged_data$ShortMAC)))

conductivity_colors_1 <- colorRampPalette(c("#ED7D31", "#9C4A2F"))(length(unique(merged_data$ShortMAC)))
conductivity_colors_2 <- colorRampPalette(c("#FF6347", "#8B0000"))(length(unique(merged_data$ShortMAC)))

# Assign color maps for 1 and 2 datasets
color_map_temperature_1 <- setNames(temperature_colors_1, unique(merged_data$ShortMAC))
color_map_temperature_2 <- setNames(temperature_colors_2, unique(merged_data$ShortMAC))

color_map_moisture_1 <- setNames(moisture_colors_1, unique(merged_data$ShortMAC))
color_map_moisture_2 <- setNames(moisture_colors_2, unique(merged_data$ShortMAC))

color_map_light_1 <- setNames(light_colors_1, unique(merged_data$ShortMAC))
color_map_light_2 <- setNames(light_colors_2, unique(merged_data$ShortMAC))

color_map_conductivity_1 <- setNames(conductivity_colors_1, unique(merged_data$ShortMAC))
color_map_conductivity_2 <- setNames(conductivity_colors_2, unique(merged_data$ShortMAC))

### Plot Temperature
plot(merged_data$Timestamp_1, merged_data$Temperature_1,
     col = color_map_temperature_1[merged_data$ShortMAC],
     pch = 16,
     xlab = "Time",
     ylab = "Temperature",
     main = "Weekly Temperature")
points(merged_data$Timestamp_1, merged_data$Temperature_2,
       col = color_map_temperature_2[merged_data$ShortMAC],
       pch = 1)
mtext(placeholder, side = 1, line = 2, cex = 0.8)

### Plot Moisture
plot(merged_data$Timestamp_1, merged_data$Moisture_1,
     col = color_map_moisture_1[merged_data$ShortMAC],
     pch = 16,
     xlab = "Time",
     ylab = "Moisture",
     main = "Weekly Moisture")
points(merged_data$Timestamp_1, merged_data$Moisture_2,
       col = color_map_moisture_2[merged_data$ShortMAC],
       pch = 1)
mtext(placeholder, side = 1, line = 2, cex = 0.8)

### Plot Light
plot(merged_data$Timestamp_1, merged_data$Light_1,
     col = color_map_light_1[merged_data$ShortMAC],
     pch = 16,
     xlab = "Time",
     ylab = "Light",
     main = "Weekly Light")
points(merged_data$Timestamp_1, merged_data$Light_2,
       col = color_map_light_2[merged_data$ShortMAC],
       pch = 1)
mtext(placeholder, side = 1, line = 2, cex = 0.8)

### Plot Conductivity
plot(merged_data$Timestamp_1, merged_data$Conductivity_1,
     col = color_map_conductivity_1[merged_data$ShortMAC],
     pch = 16,
     xlab = "Time",
     ylab = "Conductivity",
     main = "Weekly Conductivity")
points(merged_data$Timestamp_1, merged_data$Conductivity_2,
       col = color_map_conductivity_2[merged_data$ShortMAC],
       pch = 1)
mtext(placeholder, side = 1, line = 2, cex = 0.8)

```

Matrices  
# Correlation Matrices 

``` {r correlation-covariance}
  Temperature <- c(session_data$Temperature)
  Moisture <- c(session_data$Moisture)
  Light <- c(session_data$Light)
  Conductivity <- c(session_data$Conductivity)
  
  matrix_data <- data.frame(Temperature, Moisture, Light, Conductivity)  
  print("Covariance Matrix")
  cov_matrix <- cov(matrix_data)
  cov_matrix
  
  print("Correlation Matrix")
  cor_matrix <- cor(matrix_data)
  cor_matrix
```
Plotting variables against each other.

``` {r compare-relationships}

# Define the color palette
colors <- c(
    temperature = "#5B9BD5",  # Soft blue
    moisture = "#70AD47",     # Sage green
    light = "#FFC000",        # Warm yellow
    conductivity = "#ED7D31"  # Muted orange
)

# Assuming session_data is your data frame
pairs(session_data[, c("Temperature", "Moisture", "Light", "Conductivity")],
      col = colors["temperature"],  
      pch = 16,          
      main = "Scatter Plot Matrix")

# Plot Temperature vs Moisture
plot(session_data$Temperature, session_data$Moisture,
     col = adjustcolor(colors[c("temperature", "moisture")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Moisture",
     main = "Temperature vs Moisture",
     pch = 16)

# Plot Temperature vs Light
plot(session_data$Temperature, session_data$Light,
     col = adjustcolor(colors[c("temperature", "light")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Light",
     main = "Temperature vs Light",
     pch = 16)

# Plot Temperature vs Conductivity
plot(session_data$Temperature, session_data$Conductivity,
     col = adjustcolor(colors[c("temperature", "conductivity")], alpha=0.7),
     xlab = "Temperature",
     ylab = "Conductivity",
     main = "Temperature vs Conductivity",
     pch = 16)

# Plot Moisture vs Light
plot(session_data$Moisture, session_data$Light,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(session_data$Moisture, session_data$Conductivity,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(session_data$Moisture, session_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

# Plot Moisture vs Light
plot(session_data$Light, session_data$Moisture,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(session_data$Light, session_data$Conductivity,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(session_data$Light, session_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

# Plot Moisture vs Light
plot(session_data$Conductivity, session_data$Moisture,
     col = adjustcolor(colors[c("moisture", "light")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Light",
     main = "Moisture vs Light",
     pch = 16)

# Plot Moisture vs Conductivity
plot(session_data$Conductivity, session_data$Light,
     col = adjustcolor(colors[c("moisture", "conductivity")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Conductivity",
     main = "Moisture vs Conductivity",
     pch = 16)

# Plot Light vs Conductivity
plot(session_data$Conductivity, session_data$Temperature,
     col = adjustcolor(colors[c("moisture", "temperature")], alpha=0.7),
     xlab = "Moisture",
     ylab = "Temperature",
     main = "Moisture vs Temperature",
     pch = 16)

```

# Heatmap

``` {r heatmap}

# Load required library
library(ggplot2)

# Select the relevant variables for correlation
matrix_data <- session_data[, c("Temperature", "Moisture", "Light", "Conductivity")]

# Calculate the correlation matrix
cor_matrix <- cor(matrix_data, use = "complete.obs")

# Convert the correlation matrix into a format suitable for ggplot
cor_data <- as.data.frame(as.table(cor_matrix))
colnames(cor_data) <- c("Variable1", "Variable2", "Correlation")

# Create the heatmap using ggplot2
ggplot(cor_data, aes(x = Variable1, y = Variable2, fill = Correlation)) +
  geom_tile(color = "white") + # Heatmap tiles
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1), 
                       name = "Correlation") + # Color scale
  theme_minimal() + # Clean theme
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) + # Rotate x-axis labels
  labs(title = "Heatmap of Variable Correlations", x = "Variables", y = "Variables")


```